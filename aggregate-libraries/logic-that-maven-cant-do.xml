<project name="stuff-that-maven-can-not-do">

    <property name="eclipse.dir" value="${eclipse.build.location}"/>
    <property name="eclipse.plugins.dir" value="${eclipse.dir}/plugins"/>
    <property name="plugins.zip" value="${eclipse.plugins.dir}.zip"/>
    <property name="third.party.bundles.dir" value="${maven.repo}/OkapiEclipseTargetPlatform"/>


    <target name="verify">
        <available file="${plugins.zip}" property="plugins.zip.exists"/>
        <available file="${third.party.bundles.dir}" property="third.party.bundles.dir.exists"/>
        <available file="${eclipse.dir}" property="eclipse.dir.exists"/>
        <available file="${eclipse.plugins.dir}" property="eclipse.plugins.dir.exists"/>
        <fail unless="eclipse.dir.exists">.

            -Declipse.build.location was not specified
        </fail>
    </target>

    <target name="zipPlugins" depends="verify" unless="plugins.zip.exists">
        <echo>Zipping ${plugins.zip}</echo>
        <zip basedir="${eclipse.plugins.dir}" destfile="${eclipse.plugins.dir}.zip"/>
    </target>

    <target name="cleanPlugins" depends="verify,zipPlugins" if="plugins.zip.exists">
        <fail message="${eclipse.plugins.dir} does not exist. Build will not work w/o it" unless="eclipse.plugins.dir.exists"/>
        <delete dir="${eclipse.plugins.dir}"/>
        <sleep seconds="1"/>
        <mkdir dir="${eclipse.plugins.dir}"/>
        <unzip src="${plugins.zip}" dest="${eclipse.plugins.dir}"/>
    </target>

    <target name="copyOkapiRepo" depends="verify, zipPlugins">
        <echo>Copying okapi jars</echo>
        <copy todir="${eclipse.plugins.dir}" flatten="true">
            <fileset dir="../">
                <include name="**/target/*.jar"/>
            </fileset>
        </copy>
    </target>

    <target name="copyThirdPartyBundles" depends="verify, zipPlugins" if="third.party.bundles.dir.exists">
        <echo>Copying okapi required 3rd party OSGi bundles to ${eclipse.build.location}</echo>
        <copy todir="${eclipse.plugins.dir}">
            <fileset dir="${third.party.bundles.dir}">
                <include name="*.jar"/>
            </fileset>
        </copy>
    </target>
    
</project>